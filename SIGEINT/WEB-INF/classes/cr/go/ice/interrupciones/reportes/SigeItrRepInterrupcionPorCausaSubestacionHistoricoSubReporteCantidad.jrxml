<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="SigeItrRepInterrupcionPorCausaSubestacionHistoricoSubReporteCantidad" pageWidth="612" pageHeight="792" whenNoDataType="AllSectionsNoDetail" columnWidth="612" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="9154af57-312d-49a1-806a-9090c48c4873">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="DPIR" class="java.lang.Boolean">
		<defaultValueExpression><![CDATA[new Boolean(false)]]></defaultValueExpression>
	</parameter>
	<parameter name="Cantidad" class="java.lang.Boolean">
		<defaultValueExpression><![CDATA[new Boolean(false)]]></defaultValueExpression>
	</parameter>
	<parameter name="Comparativo" class="java.lang.Boolean">
		<defaultValueExpression><![CDATA[new Boolean(false)]]></defaultValueExpression>
	</parameter>
	<parameter name="mesFechaFinal" class="java.lang.Integer"/>
	<parameter name="anoFechaFinal" class="java.lang.Integer"/>
	<parameter name="subregion" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="region" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="cantidadSubestaciones" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="codigoCausaCatastrofe" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="cantidadVoltajes" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="codigoCausa" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="voltajesSTR" class="java.lang.String">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="subestacionesSTR" class="java.lang.String">
		<defaultValueExpression><![CDATA["0"]]></defaultValueExpression>
	</parameter>
	<parameter name="nombreOficina" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[new java.lang.String("nombreOficina")]]></defaultValueExpression>
	</parameter>
	<parameter name="codigoOficina" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[new java.lang.Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="fechaFinal" class="java.lang.String">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="fechaInicio" class="java.lang.String">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="tipoInterrupcion" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[new java.lang.String("tipoInterrupcion")]]></defaultValueExpression>
	</parameter>
	<parameter name="SUBREPORT_DIR" class="java.lang.String">
		<defaultValueExpression><![CDATA["/home/usuario/prueba/"]]></defaultValueExpression>
	</parameter>
	<parameter name="subestacion" class="java.lang.Integer" isForPrompting="false">
		<defaultValueExpression><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="tituloCodigoRed" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT interrupcion.sub AS
codigoNivelRed,
(select nom_subestacion from eve03c where sub = interrupcion.sub) as nombreNivelRed,
  interrupcion.causa1 AS
codigoCausa,
(select nom_causa from eve09c where cod_causa = interrupcion.causa1) as nombreCausa,
  COUNT(*) AS
cantidadInterrupciones,
  SUM(interrupcion.tiefue) AS
tiempoFuera,
  SUM(interrupcion.abo_afecta) AS
abonadosafectados,
  SUM(interrupcion.hrs_abo) AS
horasabonado,
DECODE(SUM(interrupcion.tiefue)/DECODE((COUNT(*)),0,1,(COUNT(*))),0,SUM(interrupcion.tiefue),SUM(interrupcion.tiefue)/DECODE((COUNT(*)),0,1,(COUNT(*))))  as DPA,
DECODE(SUM(interrupcion.hrs_abo)/DECODE((select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0),0,1,(select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0)),SUM(interrupcion.hrs_abo),0,SUM(interrupcion.hrs_abo)/DECODE((select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0),0,1,(select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0))) AS DPIR,
DECODE(SUM(interrupcion.abo_afecta)/DECODE((select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0),0,1,(select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0)),SUM(interrupcion.abo_afecta),0,SUM(interrupcion.abo_afecta)/DECODE((select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0),0,1,(select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0))) AS FPI,
(select NVL(sum(abon_seccion),0) from eve06h where reg = interrupcion.reg and subregion = interrupcion.subregion and sub = interrupcion.sub and mes = $P{mesFechaFinal} and aa = $P{anoFechaFinal} and congelado = 0) AS clientesatendidosnivelred
FROM eve01m interrupcion
WHERE(interrupcion.cod_oficina = $P{codigoOficina} OR $P{codigoOficina} = 0)
 AND TO_DATE(interrupcion.fecini) >= to_date($P{fechaInicio},'dd/mm/yyyy')
 AND TO_DATE(interrupcion.fecfin) <= to_date($P{fechaFinal},'dd/mm/yyyy')
 AND(interrupcion.causa1 = $P{codigoCausa} OR $P{codigoCausa} = 0)
 AND(interrupcion.reg = $P{region})
 AND(interrupcion.subregion = $P{subregion})
AND(interrupcion.sub = $P{subestacion})
 AND(interrupcion.sub IN ($P!{subestacionesSTR}) OR $P{cantidadSubestaciones}=0)
 AND(interrupcion.tipo_voltaje IN($P!{voltajesSTR}) OR $P{cantidadVoltajes}=0)
 AND interrupcion.causa1 <> $P{codigoCausaCatastrofe}
GROUP BY interrupcion.reg, interrupcion.subregion, interrupcion.sub,
  interrupcion.causa1
ORDER BY interrupcion.reg, interrupcion.subregion, interrupcion.sub,
  interrupcion.causa1]]>
	</queryString>
	<field name="CODIGONIVELRED" class="java.math.BigDecimal"/>
	<field name="NOMBRENIVELRED" class="java.lang.String"/>
	<field name="CODIGOCAUSA" class="java.math.BigDecimal"/>
	<field name="NOMBRECAUSA" class="java.lang.String"/>
	<field name="CANTIDADINTERRUPCIONES" class="java.math.BigDecimal"/>
	<field name="TIEMPOFUERA" class="java.math.BigDecimal"/>
	<field name="ABONADOSAFECTADOS" class="java.math.BigDecimal"/>
	<field name="HORASABONADO" class="java.math.BigDecimal"/>
	<field name="DPA" class="java.math.BigDecimal"/>
	<field name="DPIR" class="java.math.BigDecimal"/>
	<field name="FPI" class="java.math.BigDecimal"/>
	<field name="CLIENTESATENDIDOSNIVELRED" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<columnHeader>
		<band splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band splitType="Stretch"/>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="419" splitType="Stretch">
			<pieChart>
				<chart isShowLegend="false" customizerClass="cr.go.ice.interrupciones.reportes.customs.ChartLabelCustomizer">
					<reportElement key="element-1" x="0" y="0" width="612" height="419" uuid="8a61ec70-2d20-4f57-8356-6b80352c06c2">
						<printWhenExpression><![CDATA[$P{Cantidad}]]></printWhenExpression>
					</reportElement>
					<box>
						<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
						<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
						<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
						<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					</box>
					<chartTitle color="#000000">
						<titleExpression><![CDATA["Cantidad de Averías por Causa por " + $P{tipoInterrupcion}+'\n'+
"A nivel de: Subestación"+'\n'+
"Del: "+
$P{fechaInicio}+
" Al: "+
$P{fechaFinal}
+'\n'+ $P{tituloCodigoRed}]]></titleExpression>
					</chartTitle>
					<chartSubtitle/>
					<chartLegend/>
				</chart>
				<pieDataset>
					<keyExpression><![CDATA[$F{NOMBRECAUSA}]]></keyExpression>
					<valueExpression><![CDATA[$F{CANTIDADINTERRUPCIONES}]]></valueExpression>
					<labelExpression><![CDATA[$F{NOMBRECAUSA} + ": " + $F{CANTIDADINTERRUPCIONES}.toString()]]></labelExpression>
				</pieDataset>
				<piePlot isCircular="true">
					<plot labelRotation="45.0"/>
					<itemLabel/>
				</piePlot>
			</pieChart>
		</band>
	</pageFooter>
	<summary>
		<band height="31" splitType="Stretch">
			<printWhenExpression><![CDATA[$P{Comparativo}]]></printWhenExpression>
			<subreport isUsingCache="true">
				<reportElement key="subreport-1" x="44" y="0" width="230" height="25" uuid="12d8cd3f-1cb1-4fdf-95b1-04d5a5c831b3"/>
				<subreportParameter name="fechaFinal">
					<subreportParameterExpression><![CDATA[$P{fechaFinal}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="region">
					<subreportParameterExpression><![CDATA[$P{region}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="voltajesSTR">
					<subreportParameterExpression><![CDATA[$P{voltajesSTR}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="subestacionesSTR">
					<subreportParameterExpression><![CDATA[$P{subestacionesSTR}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DPIR">
					<subreportParameterExpression><![CDATA[$P{DPIR}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="Comparativo">
					<subreportParameterExpression><![CDATA[$P{Comparativo}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="codigoOficina">
					<subreportParameterExpression><![CDATA[$P{codigoOficina}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="subestacion">
					<subreportParameterExpression><![CDATA[$P{subestacion}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="anoFechaFinal">
					<subreportParameterExpression><![CDATA[$P{anoFechaFinal}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="codigoCausa">
					<subreportParameterExpression><![CDATA[$P{codigoCausa}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="Cantidad">
					<subreportParameterExpression><![CDATA[$P{Cantidad}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="tituloCodigoRed">
					<subreportParameterExpression><![CDATA[$P{tituloCodigoRed}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="SUBREPORT_DIR">
					<subreportParameterExpression><![CDATA[$P{SUBREPORT_DIR}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="tipoInterrupcion">
					<subreportParameterExpression><![CDATA[$P{tipoInterrupcion}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="subregion">
					<subreportParameterExpression><![CDATA[$P{subregion}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="codigoCausaCatastrofe">
					<subreportParameterExpression><![CDATA[$P{codigoCausaCatastrofe}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="mesFechaFinal">
					<subreportParameterExpression><![CDATA[$P{mesFechaFinal}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="nombreOficina">
					<subreportParameterExpression><![CDATA[$P{nombreOficina}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="cantidadVoltajes">
					<subreportParameterExpression><![CDATA[$P{cantidadVoltajes}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="cantidadSubestaciones">
					<subreportParameterExpression><![CDATA[$P{cantidadSubestaciones}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="fechaInicio">
					<subreportParameterExpression><![CDATA[$P{fechaInicio}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "SigeItrRepInterrupcionPorCausaSubestacionHistoricoSubReporteComparativo.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</summary>
</jasperReport>
